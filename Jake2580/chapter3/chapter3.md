# 프로세스의 개념

<br>

초기에 사용하던 컴퓨터는<br>프로그램을 한 번에 하나씩 실행했고<br>실행 중인 프로그램이 컴퓨터 자원을 독점함<br><br>반면에 다중 프로그래밍 환경에서는<br>여러 프로그램을 메모리에 적재하여<br>병행 실행할 수 있어 컴퓨터의 효율을 높일 수 있음

<br>

![p3-1](/Jake2580/chapter3/image/p3-1.jpg)

<br>

프로그램이 메모리로 적재되면 프로세스가 됨<br>→ 프로세스의 가장 일반적인 정의는 '실행 중인 프로그램' 이라고 보면 됨

<br>

- 프로세스를 생성하거나 실행할 때 이 자원을 할당함
	- 프로세스 점유 시간
	- 메모리
	- 파일
	- 입출력 장치 같은 자원

<br>

![p3-2](/Jake2580/chapter3/image/p3-2.jpg)

<br>

- 프로세스의 일반적인 메모리 구조
	- 스택
		- 데이터를 일시적으로 저장하는 영역
		- 지역변수에 사용하고 변수가 범위 밖으로 이동하면 공간을 해제
	- 힙
		- 코드 영역과는 별도로 유지되는 자유 영역
		- 동적으로 메모리를 할당하려고<br>프로그램 실행 중 시스템 호출을 사용했다가<br>해제하는 방법으로 활용
	- 데이터
		- 프로그램의 가상 주소 공간
		- 전역변수나 정적변수를 저장하거나 할당하고 실행하기 전에 초기화
	- 코드
		- 실행 명령을 포함하는 메모리이거나 목적 파일에 있는 프로그램 영역
		- 프로그램을 시작할 때 프로세서가<br>디스크에서 읽어 실행하는 컴파일한 프로그램을 저장

<br>

- 프로세스의 상태 변화
	- 준비 → 실행 (dispatch)
		- 준비 큐 맨 앞에 있던 프로세스가 프로세서를 점유하는 것
	- 실행 → 준비 (timeout)
		- 프로세서를 계속 독점하지 않도록 인터럽트 클록을 두어<br>특정 프로세서가 할당된 시간 동안만 프로세서를 점유하게 함
	- 실행 → 대기 (block)
		- 할당된 시간 이전에<br>실행 상태의 프로세스에 입출력 연산 등이 필요하거나<br>새로운 자원 요청 등의 문제로 스스로 양도하면 대기 상태가 됨
	- 대기 → 준비 (wakeup)
		- 프로세서는 입출력 작업이 끝나면 wake up 으로 대기에서 준비 상태가 됨

<br>

# 프로세스의 구조

<br>

![p3-9](/Jake2580/chapter3/image/p3-9.jpg)

<br>

- 부모 프로세스
	- 실행 중에 프로세스 생성 시스템 호출을 이용하여<br>새로운 프로세스(자식 프로세스)를 생성할 수 있음
	- 프로세스 생성 순서를 저장하고<br>부모-자식 관계를 유지하여 계층적으로 생성함

<br>

- 프로세스
	- 생성
		- 프로세스 식별자를 결정
		- 시스템에 알려진 프로세스 리스트에 식별자를 삽입
		- 프로세스에 초기 우선순위를 부여
		- 프로세스 제어블록을 생성
		- 프로세스에 초기 자원을 할당
	- 종료
		- 자식 프로세스가 할당된 자원을 초과하여 자원을 사용할 때
		- 자식 프로세스에 할당된 작업이 더는 없을 때
	- 제거
		- 프로세스를 파괴하여 제거하는 것
		- 제거하면 프로세스에 속한 자원을 시스템으로 돌려줌
		- 부모 프로세스가 제거되면 해당 자식 프로세스도 자동으로 제거
	- 중단과 재시작
		- 시스템에 장애가 발생
		- 프로세스의 어느 부분이 의심스러울 때
		- 처리할 일이 많아 시스템 부담이 클 때
	- 우선순위 변경
		- 우선순위가 높은 프로세스
			- 속도가 느리면서 빠른 응답을 요구하는 단말기 입출력 프로세스
			- 시간 할당량을 적게 제공
		- 우선순위가 낮은 프로세스
			- 속도가 빠른 디스크 입출력 프로세스
			- 시간 할당량을 크게 제공
	- 문맥 교환
		- 입출력 인터럽트
			- 입출력 동작이 발생했음을 확인하고 이벤트를 기다리는 프로세스를<br>준비 상태로 바꾼 후 실행할 프로세스를 결정
		- 클록 인터럽트
			- 현재 실행 중인 프로세스와 할당 시간을 조사하여 실행 중인 프로세스를<br>준비 상태로 바꾸고 다른 프로세스를 실행 상태로 바꿈
		- 일반적으로 운영체제에서<br>문맥 교환이 자주 발생하기 때문에<br>가능한 효율적으로 구현해야 하는데<br>스레드를 이용하여 문맥 교환을 효율적으로 처리할 수 있음



# 스레드의 개념

<br>

- 프로세스의 특성
	- 자원
	- 제어
		- 이 제어 부분만 분리한 실행 단위를 스레드(Thread) 라고 함

<br>

- 스레드
	- 프로세스의 직접 실행 정보를 제외하고 나머지 프로세스 관리 정보를 공유함
	- 사용자 응답성 증가
	- 프로세스 자원과 메모리 공유 가능
	- 경제성 좋음
	- 다중 처리(멀티 프로세싱)로 성능과 효율 향상

<br>

- 단일(싱글) 스레드
	- 장점
		- 자원 접근에 대한 동기화
			- 멀티 스레드는 자원을 공유하면서 동기화를 고려해야 하는데<br>싱글 스레드는 신경쓰지 않아도 됨
		- 문맥 교환 작업을 하지 않음
			- 싱글 스레드로 동작하기 때문에 문맥 교환이 필요없음
	- 단점
		- CPU 코어를 모두 활용하지 못함
			- 멀티 코어 머신에서는 CPU 사용을 최적화할 수 없음

<br>

- 다중(멀티) 스레드
	- 장점
		- 문맥 교환이 빠름
			- 프로세스에 비해 레지스터와 스택만 교환하고<br>공유 자원은 교환하지 않아도 돼 더 빠르게 문맥 교환이 가능
		- CPU 활용
			- 싱글 스레드와 다르게 다중 CPU 구조에서 각각의 스레드가<br>다른 프로세스에서 병렬로 수행될 수 있음
	- 단점
		- 임계 영역
			- 둘 이상의 스레드가 동시에 실행하며 문제를 일으키는 코드 영역
		- 동기화 문제
			- 둘 이상의 스레드에서 공유 자원에 접근할 때<br>다른 스레드에서 사용 중인 경우 값을 읽어 올 때 동기화 문제가 발생할 수 있음
			- JAVA의 synchronized와 같은 기능을 쓰면 동기화를 할 수있음

<br>

# 스레드의 구현

<br>

![p3-20](/Jake2580/chapter3/image/p3-20.jpg)

<br>

- 사용자 수준 스레드
	- 다대일 (n:1) 매핑
	- 스레드 라이브러리를 이용하여 작동하는 형태
		- POSIX 표준안의 스레드 확장판인 Pthread
		- Win32 Thread
		- Java Thread API
	- 장점
		- 이식성 높음
		- 오버헤드 적음
		- 유연한 스케쥴링
	- 단점
		- 시스템의 동시성을 지원하지 않음
		- 확장에 제약
		- 스레드간 보호 불가능

<br>

![p3-21](/Jake2580/chapter3/image/p3-21.jpg)

<br>

- 커널 수준 스레드
	- 일대일 (1:1) 매핑
	- 커널(운영체제)에서 지원하는 형태
	- 장점
		- 사용자 수준 스레드의 단점을 극복
		- 스레드 중 한 개가 대기 상태가 되더라도 다른 스레드를 실행할 수 있음
		- 다른 프로세스의 스레드를 병행으로 수행 가능
	- 단점
		- 커널이 전체 프로세스와 스레드 정보를 유지하여 오버헤드가 커짐
		- 동기화를 하기 위해 더 많은 자원이 필요

<br>

![p3-22](/Jake2580/chapter3/image/p3-22.jpg)

<br>

- 혼합형 스레드
	- 다대다 (n:m) 매핑
	- 사용자 수준 스레드 + 커널 수준 스레드의 형태
	- 스레드 라이브러리가 최적의 성능을 냄
	- 커널 영역에서 병렬 처리 정도를 매핑이 결정할 수 있어서<br>병행 실행이 의미가 없을 때는 다대일(n:1) 매핑도 가능함
	- 스레드 폴링
		- 시스템이 관리하는 스레드의 풀을 응용 프로그램에 제공하여<br>스레드를 효율적으로 사용할 수 있게 하는 방법
		- 미리 생성한 스레드를 재사용하도록하여 스레드를 생성하는 시간을 줄여서<br>시스템의 부담을 덜어 줌
		- 동시에 생성할 수 있는 스레드의 수를 제한하여 시스템의 자원 소비를 줄여서<br>응용 프로그램의 전체 성능을 일정 수준으로 유지함

<br>

